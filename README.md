# Sweph-Wasm
Using Sweph (Swiss Ephemeris) with Wasm (Emscripten)  

Based on code written by @randogoth [sublunar.almanac](https://github.com/randogoth/sublunar.almanac).  
I extrapolated the sweph part with wasm and I created this web application that allows you to query the functions of the Swiss Ephemeris to generate ephemeris.


The application is ready to run.  
The compiled files are:  
<blockquote>

 
astro.data (contains sweph files - **virtual file system**)  
astro.js (browser readable file)  
astro.wasm (binaries)

</blockquote>
To use the application run the index.html file using a local web server (localhost).

If you run the index.html file (file://) directly, browsers create a Cors error.  
If you don't have a local web server you can use the **emrun** command (see below).

## Virtual file system
The most important change was the creation of a virtual file system.  
Emscripten allows you to embed files that will be used within an application. Specifically, it creates a file with the ".data" extension which will contain all of the additional files.  
To create a vfs you need to pass a parameter to the compiler (in the Makefile) indicating the directory containing the files, in our case "eph"

<blockquote>
--preload-file eph
</blockquote>
The compiler will create a ".data" file containing all the files in the folder.


From code just make sweph point to the "eph" directory

<blockquote>
swe_set_ephe_path("eph");
</blockquote>

[Here the documentation](https://emscripten.org/docs/porting/files/packaging_files.html)

## How to compile
Make sure Emscripten is installed and working :slightly_smiling_face:. [Here the documentation](https://emscripten.org/docs/getting_started/downloads.html)  
From Command Line Interface (CLI) change to the sweph-wasm/lib/src directory.  
To execute
<blockquote>

make astro (compile sweph files and astro.c file)
 
make install (copy the files generated by the compiler to the right directory)
 
</blockquote>


## Emrun
If you don't have a local web server (localhost) you can use the emrun command.  
Just add **--emrun** to your compiler (Makefile), compile.

To run the application:
<blockquote>
emrun index.html
</blockquote>

[Here the documentation](https://emscripten.org/docs/compiling/Running-html-files-with-emrun.html)

## Sweph files ephemeris
The application loads these three files into the virtual file system:

<blockquote>
 
 
seas_18.se1  
semo_18.se1  
sepl_18.se1  
 

</blockquote>

These are sweph's high-precision ephemeris files.  
These files have a date range from the year 1800 to 2400.  
If you want to widen the date range just add the others files in the sweph-wasm/lib/src/eph directory and compile.  
The compiler will add all the files present in the directory and create the astro.data file.  

Command:
<blockquote>
 
 
make astro  
make install  
 
 
</blockquote>


## How does it work

The astro.c file contains the logic to create the ephemeris. It interfaces with sweph and also contains functions that can be called from javascript.

A "web worker" is created from the browser which calls the "astro.js" file.

The web worker issues commands to functions in the astro.c file which returns a json string to the web worker. The return json is then processed by javascript.

The astro.js file is one of the files that is created by the compiler.

## Preload data
To enable data preloading, uncomment the line:


####   <!--- <script type="text/javascript" src="js/preloadData.js"></script> --->


present in the index.html file


## The Application Web

![The Application Web](/assets/img/sweph-wasm.png)

## Swiss Ephemeris Functions for Web-Based Astrology Applications

This comprehensive guide lists the most useful Swiss Ephemeris functions for creating web-based astrology applications, with detailed explanations tailored for astrologers who may not have deep astronomical knowledge.

### üåü **Core Planetary Calculations**

#### **Basic Planet Positions**

##### **`swe_calc_ut(tjd_ut, ipl, iflag, xx, serr)`**
**Purpose**: Calculate planetary positions for any date/time using Universal Time

**Parameters**:
- `tjd_ut`: Julian Day in Universal Time (use `swe_julday()` to convert from calendar date)
- `ipl`: Planet number (0=Sun, 1=Moon, 2=Mercury, 3=Venus, 4=Mars, 5=Jupiter, 6=Saturn, 7=Uranus, 8=Neptune, 9=Pluto)
- `iflag`: Calculation flags (see flags section below)
- `xx`: Array to receive results [longitude, latitude, distance, speed_long, speed_lat, speed_dist]
- `serr`: Error message buffer

**Returns**: 
- `xx[0]`: Ecliptic longitude (0-360¬∞) - zodiacal position
- `xx[1]`: Ecliptic latitude (-90 to +90¬∞) - north/south of ecliptic
- `xx[2]`: Distance from Earth in AU (Astronomical Units)
- `xx[3]`: Daily motion in longitude (degrees/day)
- `xx[4]`: Daily motion in latitude (degrees/day)  
- `xx[5]`: Daily motion in distance (AU/day)

**Astrology Applications**:
- **Natal Charts**: Get birth positions of all planets
- **Transits**: Current planetary positions vs natal
- **Progressions**: Secondary progressions using adjusted dates
- **Solar Returns**: Sun's position for birthday calculations
- **Synastry**: Compare planetary positions between charts

**Example Usage**:
```javascript
// Calculate Mars position for January 1, 2024, 12:00 UT
const jd = swe_julday(2024, 1, 1, 12.0, SE_GREG_CAL);
const mars_data = new Array(6);
const result = swe_calc_ut(jd, SE_MARS, SEFLG_SWIEPH | SEFLG_SPEED, mars_data, error_buffer);
// mars_data[0] = longitude in degrees (e.g., 285.5¬∞ = 15¬∞30' Capricorn)
// mars_data[3] = daily motion (e.g., 0.5¬∞/day = normal direct motion)
```

##### **`swe_calc(tjd_et, ipl, iflag, xx, serr)`**
**Purpose**: Same as `swe_calc_ut()` but uses Ephemeris Time for maximum precision

**When to Use**:
- Historical dates before 1600 CE or after 2200 CE
- When you need the highest possible precision
- Research applications requiring exact astronomical positions
- Must add Delta T to Universal Time: `tjd_et = tjd_ut + swe_deltat(tjd_ut)/86400.0`

#### **Calculation Flags (iflag parameter)**

**Ephemeris Selection**:
- `SEFLG_SWIEPH` (2): Swiss Ephemeris (default, most accurate)
- `SEFLG_JPLEPH` (1): JPL ephemeris (requires JPL files)
- `SEFLG_MOSEPH` (4): Moshier ephemeris (built-in, less accurate)

**Coordinate Options**:
- `SEFLG_HELCTR` (8): Heliocentric positions (Sun-centered)
- `SEFLG_BARYCTR` (16): Barycentric positions (solar system center of mass)
- `SEFLG_TOPOCTR` (32): Topocentric positions (from observer's location)

**Reference Frame Options**:
- `SEFLG_J2000` (32): J2000.0 coordinates (fixed epoch)
- `SEFLG_NONUT` (64): Mean equinox (no nutation)
- `SEFLG_TRUEPOS` (16): True geometric position (no light-time)

**Additional Options**:
- `SEFLG_SPEED` (256): Include velocity calculations (recommended)
- `SEFLG_NOGDEFL` (512): No gravitational deflection
- `SEFLG_NOABERR` (1024): No annual aberration

**Common Flag Combinations**:
```javascript
// Standard tropical astrology
const STANDARD_FLAGS = SEFLG_SWIEPH | SEFLG_SPEED;

// Sidereal astrology  
const SIDEREAL_FLAGS = SEFLG_SWIEPH | SEFLG_SPEED | SEFLG_SIDEREAL;

// Heliocentric astrology
const HELIO_FLAGS = SEFLG_SWIEPH | SEFLG_SPEED | SEFLG_HELCTR;
```

#### **Planetary Nodes and Apsides**

##### **`swe_nod_aps(tjd_et, ipl, iflag, method, xnasc, xndsc, xperi, xaphe, serr)`**
**Purpose**: Calculate lunar nodes, planetary nodes, and apsides (orbital extreme points)

**Parameters**:
- `tjd_et`: Julian Day in Ephemeris Time
- `ipl`: Planet number (0-9 for Sun-Pluto)
- `iflag`: Same flags as `swe_calc()`
- `method`: Calculation method (see below)
- `xnasc`: Array for ascending node data [6 elements]
- `xndsc`: Array for descending node data [6 elements]  
- `xperi`: Array for perihelion data [6 elements]
- `xaphe`: Array for aphelion data [6 elements]

**Calculation Methods**:
- `SE_NODBIT_MEAN` (0): Mean elements (traditional)
- `SE_NODBIT_OSCU` (1): Osculating elements (instantaneous orbit)
- `SE_NODBIT_OSCU_BAR` (2): Barycentric osculating elements
- `SE_NODBIT_FOPOINT` (4): Focal point instead of aphelion

**Astrology Applications**:
- **Lunar Nodes**: Essential for karmic astrology, eclipse predictions
- **Planetary Nodes**: Advanced techniques, harmonic astrology
- **Apsides**: Closest/farthest points, intensity cycles
- **Black Moon Lilith**: Mean or true apogee of Moon's orbit

**Node Types Explained**:
- **Ascending Node**: Where planet crosses ecliptic going north
- **Descending Node**: Where planet crosses ecliptic going south  
- **Perihelion**: Closest point to Sun in orbit
- **Aphelion**: Farthest point from Sun in orbit

### üè† **House System Calculations**

#### **House Cusps and Angles**

##### **`swe_houses_ex(tjd_ut, iflag, geolat, geolon, hsys, cusps, ascmc)`**
**Purpose**: Calculate house cusps for any house system with full precision

**Parameters**:
- `tjd_ut`: Julian Day in Universal Time
- `iflag`: Calculation flags (usually `SEFLG_SWIEPH`)
- `geolat`: Geographic latitude in degrees (positive = North)
- `geolon`: Geographic longitude in degrees (positive = East)
- `hsys`: House system character (see house systems below)
- `cusps`: Array for 12 house cusps [13 elements, index 0 unused]
- `ascmc`: Array for angles [10 elements]

**Returns in cusps array**:
- `cusps[1]` through `cusps[12]`: House cusps 1-12 in degrees
- House 1 cusp = Ascendant, House 10 cusp = Midheaven

**Returns in ascmc array**:
- `ascmc[0]`: Ascendant (ASC)
- `ascmc[1]`: Midheaven (MC) 
- `ascmc[2]`: ARMC (Sidereal Time)
- `ascmc[3]`: Vertex
- `ascmc[4]`: Equatorial Ascendant
- `ascmc[5]`: Co-Ascendant (Koch)
- `ascmc[6]`: Co-Ascendant (Munkasey)
- `ascmc[7]`: Polar Ascendant

##### **`swe_house_pos(armc, geolat, eps, hsys, xpin, serr)`**
**Purpose**: Find which house a planet occupies

**Parameters**:
- `armc`: Sidereal time (from `ascmc[2]` above)
- `geolat`: Geographic latitude
- `eps`: Obliquity of ecliptic (from `swe_calc(SE_ECL_NUT)`)
- `hsys`: House system character
- `xpin`: Planet position [longitude, latitude]

**Returns**: House position as decimal (e.g., 5.75 = 75% through 5th house)

#### **House Systems Available**

**Most Popular Systems**:
- **'P' - Placidus**: Most widely used in modern Western astrology
  - *Characteristics*: Unequal houses, time-based divisions
  - *Best for*: Psychological astrology, modern interpretations
  - *Limitations*: Can fail at extreme latitudes

- **'K' - Koch**: Popular in Europe, similar to Placidus
  - *Characteristics*: Birthplace-oriented, unequal houses
  - *Best for*: European astrology traditions
  - *Advantages*: Works better at high latitudes than Placidus

- **'W' - Whole Sign**: Ancient system, each sign = one house
  - *Characteristics*: Each house is exactly 30¬∞, simple and clear
  - *Best for*: Traditional astrology, Hellenistic techniques
  - *Advantages*: Never fails, works at any latitude

- **'A' or 'E' - Equal**: Each house is 30¬∞ from Ascendant
  - *Characteristics*: Equal 30¬∞ houses starting from Ascendant
  - *Best for*: Simplified modern astrology
  - *Advantages*: Simple, consistent, works everywhere

**Traditional Systems**:
- **'R' - Regiomontanus**: Medieval system, mathematically elegant
- **'C' - Campanus**: Medieval system, great circle based
- **'O' - Porphyry**: Ancient system, divides quadrants equally
- **'M' - Morinus**: Equatorial system

**Specialized Systems**:
- **'T' - Topocentric (Polich/Page)**: Modern system for precise timing
- **'H' - Horizon/Azimuth**: Local space astrology
- **'G' - Gauquelin Sectors**: 36 sectors for statistical research
- **'X' - Meridian Houses**: Axial rotation system

**Example House Calculation**:
```javascript
// Calculate houses for New York (40.7¬∞N, 74.0¬∞W) on Jan 1, 2024, 12:00 UT
const jd = swe_julday(2024, 1, 1, 12.0, SE_GREG_CAL);
const cusps = new Array(13);  // Index 0 unused
const ascmc = new Array(10);
const result = swe_houses_ex(jd, SEFLG_SWIEPH, 40.7, -74.0, 'P', cusps, ascmc);

// Results:
// cusps[1] = Ascendant degree
// cusps[10] = Midheaven degree  
// ascmc[0] = Ascendant (same as cusps[1])
// ascmc[1] = Midheaven (same as cusps[10])
```

### ‚≠ê **Fixed Stars**

#### **Star Positions and Data**

##### **`swe_fixstar_ut(star, tjd_ut, iflag, xx, serr)`**
**Purpose**: Calculate current position of any named fixed star

**Parameters**:
- `star`: Star name (traditional or catalog name)
- `tjd_ut`: Julian Day in Universal Time
- `iflag`: Calculation flags
- `xx`: Array for results [6 elements]
- `serr`: Error message buffer

**Star Name Formats**:
- **Traditional names**: "Regulus", "Spica", "Algol", "Sirius"
- **Bayer designations**: "alpha Leo", "beta Vir", "beta Per"
- **Catalog numbers**: "HIP 87901", "HD 124897"

**Major Fixed Stars for Astrology**:

**Royal Stars (Watchers of Heaven)**:
- **Regulus** (alpha Leo): 29¬∞50' Leo - Heart of the Lion, leadership
- **Aldebaran** (alpha Tau): 9¬∞47' Gemini - Watcher of the East, integrity  
- **Antares** (alpha Sco): 9¬∞46' Sagittarius - Watcher of the West, courage
- **Fomalhaut** (alpha PsA): 3¬∞52' Pisces - Watcher of the North, idealism

**Bright Navigation Stars**:
- **Sirius** (alpha CMa): 14¬∞05' Cancer - Brightest star, spiritual significance
- **Canopus** (alpha Car): 14¬∞58' Cancer - Second brightest, guidance
- **Arcturus** (alpha Boo): 24¬∞14' Libra - Bear guard, protection
- **Vega** (alpha Lyr): 15¬∞19' Capricorn - Pole star of 12,000 BCE

**Constellation Alpha Stars**:
- **Polaris** (alpha UMi): 28¬∞33' Gemini - Current pole star, destiny
- **Capella** (alpha Aur): 21¬∞51' Gemini - The goat star, nurturing
- **Rigel** (beta Ori): 16¬∞50' Gemini - Left foot of Orion, innovation
- **Betelgeuse** (alpha Ori): 28¬∞45' Gemini - Right shoulder of Orion, success

**Astrology Applications**:
- **Conjunctions**: When planets align with fixed stars (¬±1¬∞ orb)
- **Parans**: When stars and planets rise/set simultaneously
- **Star Maps**: Mapping fixed stars to natal chart
- **Mundane Events**: Fixed star influences on world events
- **Timing**: Heliacal risings for ancient calendar systems

##### **`swe_fixstar_mag(star, mag, serr)`**
**Purpose**: Get visual magnitude (brightness) of a star

**Returns**: Magnitude value (lower = brighter, negative = very bright)
- **Sirius**: -1.46 (brightest star)
- **Canopus**: -0.74
- **Sun**: -26.7 (for comparison)
- **Naked eye limit**: +6.0

### üåô **Eclipse and Occultation Calculations**

#### **Solar Eclipses**

##### **`swe_sol_eclipse_when_glob(tjd_start, iflag, ifltype, tret, backward, serr)`**
**Purpose**: Find next or previous solar eclipse globally

**Parameters**:
- `tjd_start`: Starting Julian Day for search
- `iflag`: Ephemeris flags
- `ifltype`: Eclipse type filter (see below)
- `tret`: Array for eclipse times [10 elements]
- `backward`: 0 = search forward, 1 = search backward
- `serr`: Error message buffer

**Eclipse Type Filters**:
- `SE_ECL_TOTAL` (1): Total solar eclipses only
- `SE_ECL_ANNULAR` (2): Annular eclipses only  
- `SE_ECL_PARTIAL` (4): Partial eclipses only
- `SE_ECL_ALLTYPES_SOLAR` (7): All solar eclipse types

**Returns in tret array**:
- `tret[0]`: Maximum eclipse time (Julian Day)
- `tret[1]`: First contact (eclipse begins)
- `tret[2]`: Second contact (totality begins)
- `tret[3]`: Third contact (totality ends)
- `tret[4]`: Fourth contact (eclipse ends)

##### **`swe_sol_eclipse_when_loc(tjd_start, iflag, geopos, tret, attr, backward, serr)`**
**Purpose**: Find solar eclipses visible from specific location

**Parameters**:
- `geopos`: Array [longitude, latitude, elevation] of observer
- `attr`: Array for eclipse attributes [20 elements]

**Returns in attr array**:
- `attr[0]`: Fraction of Sun's diameter covered
- `attr[1]`: Ratio of lunar to solar diameter
- `attr[2]`: Fraction of Sun's area covered
- `attr[8]`: Eclipse magnitude
- `attr[9]`: Saros cycle number

#### **Lunar Eclipses**

##### **`swe_lun_eclipse_when(tjd_start, iflag, ifltype, tret, backward, serr)`**
**Purpose**: Find lunar eclipses

**Lunar Eclipse Types**:
- `SE_ECL_TOTAL` (1): Total lunar eclipses
- `SE_ECL_PENUMBRAL` (16): Penumbral eclipses
- `SE_ECL_PARTIAL` (4): Partial eclipses

**Astrology Applications**:
- **Eclipse Seasons**: Periods of transformation and change
- **Saros Cycles**: 18-year eclipse family patterns
- **Eclipse Paths**: Geographic areas most affected
- **Prenatal Eclipses**: Eclipses before birth affecting life themes
- **Mundane Astrology**: Eclipses affecting nations and world events

### üåÖ **Rising, Setting, and Visibility**

#### **Heliacal Phenomena**

##### **`swe_heliacal_ut(tjdstart_ut, geopos, datm, dobs, ObjectName, TypeEvent, iflag, dret, serr)`**
**Purpose**: Calculate heliacal risings and settings of stars and planets

**Parameters**:
- `tjdstart_ut`: Starting date for search
- `geopos`: Observer position [longitude, latitude, elevation]
- `datm`: Atmospheric conditions [pressure, temperature, humidity, meteorological_range]
- `dobs`: Observer data [age, Snellen_ratio, binocular_magnification, optical_aperture, optical_magnification, optical_transmission]
- `ObjectName`: Star or planet name
- `TypeEvent`: Type of heliacal event (see below)

**Heliacal Event Types**:
- `SE_HELIACAL_RISING` (1): First morning visibility
- `SE_HELIACAL_SETTING` (2): Last evening visibility  
- `SE_MORNING_FIRST` (1): Same as heliacal rising
- `SE_EVENING_LAST` (2): Same as heliacal setting
- `SE_EVENING_FIRST` (3): First evening visibility (superior planets)
- `SE_MORNING_LAST` (4): Last morning visibility (superior planets)

**Astrology Applications**:
- **Ancient Calendars**: Egyptian, Babylonian star calendars
- **Seasonal Markers**: Agricultural and religious timing
- **Star Mythology**: When stars "die" and are "reborn"
- **Planetary Cycles**: Venus and Mercury visibility patterns
- **Traditional Timing**: Electional astrology based on star visibility

##### **`swe_rise_trans(tjd_ut, ipl, starname, epheflag, rsmi, geopos, atpress, attemp, tret, serr)`**
**Purpose**: Calculate exact rise, set, and transit times

**Parameters**:
- `rsmi`: Rise/set/transit flag
  - `SE_CALC_RISE` (1): Rising time
  - `SE_CALC_SET` (2): Setting time  
  - `SE_CALC_MTRANSIT` (4): Upper meridian transit (culmination)
  - `SE_CALC_ITRANSIT` (8): Lower meridian transit

**Astrology Applications**:
- **Planetary Hours**: Traditional timing system
- **Electional Astrology**: Choosing optimal times
- **Local Space**: Location-specific astrology
- **Daily Rhythms**: Planetary influence timing

### üïê **Time and Calendar Functions**

#### **Date Conversions**

##### **`swe_julday(year, month, day, hour, gregflag)`**
**Purpose**: Convert calendar date to Julian Day Number

**Parameters**:
- `year`: Calendar year (negative for BCE)
- `month`: Month (1-12)
- `day`: Day (1-31)
- `hour`: Hour as decimal (12.5 = 12:30)
- `gregflag`: Calendar type
  - `SE_GREG_CAL` (1): Gregorian calendar (after Oct 4, 1582)
  - `SE_JUL_CAL` (0): Julian calendar (before Oct 15, 1582)

**Returns**: Julian Day Number as double

**Historical Calendar Notes**:
- **Gregorian Reform**: Oct 4, 1582 (Julian) ‚Üí Oct 15, 1582 (Gregorian)
- **Automatic Switching**: Swiss Ephemeris handles calendar transition
- **BCE Dates**: Use negative years (1 BCE = year 0, 2 BCE = year -1)

##### **`swe_revjul(jd, gregflag, jyear, jmon, jday, jut)`**
**Purpose**: Convert Julian Day back to calendar date

##### **`swe_utc_to_jd(iyear, imonth, iday, ihour, imin, dsec, gregflag, dret, serr)`**
**Purpose**: Convert UTC time to Julian Day (handles leap seconds)

**Returns in dret array**:
- `dret[0]`: Julian Day in Ephemeris Time (ET)
- `dret[1]`: Julian Day in Universal Time (UT)

##### **`swe_deltat(tjd)`**
**Purpose**: Calculate Delta T (difference between Earth rotation time and atomic time)

**Returns**: Delta T in seconds
- **Usage**: Add to UT to get ET: `tjd_et = tjd_ut + swe_deltat(tjd_ut)/86400.0`
- **Historical Variation**: Delta T changes over time due to Earth's rotation slowing

#### **Sidereal Time**

##### **`swe_sidtime(tjd_ut)`**
**Purpose**: Calculate Greenwich Mean Sidereal Time

**Returns**: Sidereal time in hours (0-24)
- **Usage**: Essential for house calculations
- **Local Sidereal Time**: Add longitude in hours (longitude_degrees / 15.0)

### üåå **Coordinate Transformations**

#### **Different Coordinate Systems**

##### **`swe_azalt(tjd_ut, calc_flag, geopos, atpress, attemp, xin, xaz)`**
**Purpose**: Convert ecliptic coordinates to horizon coordinates (azimuth/altitude)

**Parameters**:
- `calc_flag`: Calculation options
  - `SE_ECL2HOR` (0): Ecliptic to horizon
  - `SE_EQU2HOR` (1): Equatorial to horizon
- `geopos`: Observer position [longitude, latitude, elevation]
- `atpress`: Atmospheric pressure (mbar, 0 = no refraction)
- `attemp`: Temperature (¬∞C)
- `xin`: Input coordinates [longitude, latitude] or [RA, declination]
- `xaz`: Output [azimuth, altitude, apparent_altitude]

**Coordinate Systems Explained**:
- **Azimuth**: Direction along horizon (0¬∞ = North, 90¬∞ = East, 180¬∞ = South, 270¬∞ = West)
- **Altitude**: Height above horizon (0¬∞ = horizon, 90¬∞ = zenith, negative = below horizon)
- **Apparent Altitude**: Corrected for atmospheric refraction

##### **`swe_cotrans(xpo, xpn, eps)`**
**Purpose**: Transform between ecliptic and equatorial coordinates

**Parameters**:
- `xpo`: Input coordinates [longitude, latitude, distance]
- `xpn`: Output coordinates [RA, declination, distance]  
- `eps`: Obliquity of ecliptic (from `swe_calc(SE_ECL_NUT)`)

**Coordinate Systems**:
- **Ecliptic**: Based on Earth's orbit (longitude = zodiacal position)
- **Equatorial**: Based on Earth's equator (RA = right ascension, Dec = declination)
- **Galactic**: Based on Milky Way plane
- **Horizon**: Based on observer's local horizon

### üîÑ **Sidereal Astrology**

#### **Ayanamsa Calculations**

##### **`swe_set_sid_mode(sid_mode, t0, ayan_t0)`**
**Purpose**: Set sidereal calculation mode for tropical-to-sidereal conversion

**Parameters**:
- `sid_mode`: Ayanamsa system number (see below)
- `t0`: Reference date (Julian Day, usually J2000.0 = 2451545.0)
- `ayan_t0`: Ayanamsa value at reference date

**Major Ayanamsa Systems**:
- **SE_SIDM_LAHIRI** (1): Lahiri (Chitrapaksha) - Official Indian system
- **SE_SIDM_KRISHNAMURTI** (5): KP system - Popular in India
- **SE_SIDM_RAMAN** (3): B.V. Raman - Traditional Indian
- **SE_SIDM_FAGAN_BRADLEY** (0): Fagan-Bradley - Western sidereal
- **SE_SIDM_DELUCE** (9): DeLuce - Western sidereal alternative
- **SE_SIDM_J2000** (18): J2000 - Fixed to epoch 2000.0
- **SE_SIDM_TRUE_CITRA** (27): True Chitrapaksha - Astronomical Spica
- **SE_SIDM_TRUE_REVATI** (28): True Revati - Astronomical zeta Piscium

##### **`swe_get_ayanamsa_ut(tjd_ut)`**
**Purpose**: Get current ayanamsa value (precession correction)

**Returns**: Ayanamsa in degrees
- **Usage**: Subtract from tropical longitude to get sidereal longitude
- **Example**: Tropical 15¬∞ Aries - 24¬∞ ayanamsa = 21¬∞ Pisces sidereal

**Sidereal vs Tropical**:
- **Tropical Zodiac**: Fixed to seasons (0¬∞ Aries = Spring Equinox)
- **Sidereal Zodiac**: Fixed to stars (0¬∞ Aries = star Revati or Spica)
- **Precession**: Earth's axis wobbles, causing 50.3" per year shift
- **Current Difference**: About 24¬∞ (tropical ahead of sidereal)

### üéØ **Specialized Calculations**

#### **Planetary Phenomena**

##### **`swe_pheno_ut(tjd_ut, ipl, iflag, attr, serr)`**
**Purpose**: Calculate planetary phenomena (phases, brightness, apparent size)

**Returns in attr array**:
- `attr[0]`: Phase angle (angle Sun-planet-Earth)
- `attr[1]`: Phase (illuminated fraction, 0-1)
- `attr[2]`: Elongation (angular distance from Sun)
- `attr[3]`: Apparent diameter (arc seconds)
- `attr[4]`: Apparent magnitude (brightness)

**Astrology Applications**:
- **Lunar Phases**: New, waxing, full, waning moon calculations
- **Planetary Brightness**: Visibility and prominence
- **Retrograde Cycles**: Phase angle changes during retrograde
- **Elongation Cycles**: Maximum elongations of Mercury and Venus

#### **Crossings and Transits**

##### **`swe_solcross_ut(x2cross, jd_ut, flag, serr)`**
**Purpose**: Find when Sun crosses specific longitude

**Parameters**:
- `x2cross`: Longitude to cross (0-360¬∞)
- `jd_ut`: Starting search date
- `flag`: Direction (0 = next crossing, 1 = previous crossing)

**Returns**: Julian Day when crossing occurs

**Astrology Applications**:
- **Solar Returns**: When Sun returns to natal position
- **Ingresses**: When Sun enters new zodiac signs
- **Seasonal Points**: Equinoxes and solstices
- **Degree Crossings**: Precise timing for specific degrees

##### **`swe_mooncross_ut(x2cross, jd_ut, flag, serr)`**
**Purpose**: Find when Moon crosses specific longitude

**Astrology Applications**:
- **Lunar Returns**: Monthly lunar cycles
- **Void of Course**: Moon's last aspect before sign change
- **Lunar Ingresses**: Moon entering new signs
- **Degree Timing**: Precise lunar timing

### üìä **Advanced Implementation Guidance**

#### **Error Handling and Validation**

**Return Value Checking**:
```javascript
const result = swe_calc_ut(jd, planet, flags, coords, error_buffer);
if (result < 0) {
    console.error("Calculation failed:", error_buffer);
    return null;
}
if (result & SEFLG_SWIEPH) {
    // Swiss Ephemeris used successfully
} else {
    console.warn("Fallback ephemeris used");
}
```

**Date Range Validation**:
- **Optimal Range**: 1800-2400 CE (Swiss Ephemeris files)
- **Extended Range**: 5400 BCE - 5400 CE (calculated)
- **Accuracy Degradation**: Outside optimal range, precision decreases

#### **Performance Optimization**

**Batch Calculations**:
```javascript
// Calculate all planets at once for efficiency
const planets = [SE_SUN, SE_MOON, SE_MERCURY, SE_VENUS, SE_MARS, 
                SE_JUPITER, SE_SATURN, SE_URANUS, SE_NEPTUNE, SE_PLUTO];
const chart_data = {};

for (let planet of planets) {
    const coords = new Array(6);
    const result = swe_calc_ut(jd, planet, flags, coords, error_buffer);
    if (result >= 0) {
        chart_data[planet] = {
            longitude: coords[0],
            latitude: coords[1], 
            distance: coords[2],
            speed: coords[3]
        };
    }
}
```

**Memory Management**:
- Call `swe_close()` when done with calculations
- Reuse coordinate arrays instead of creating new ones
- Cache Julian Day calculations for repeated use

#### **Precision and Accuracy Guidelines**

**Coordinate Precision**:
- **Standard**: ¬±0.001¬∞ (3.6 arc seconds)
- **High Precision**: ¬±0.0001¬∞ (0.36 arc seconds)  
- **Maximum**: ¬±0.00001¬∞ (0.036 arc seconds)

**Time Precision**:
- **Standard**: ¬±1 second
- **High Precision**: ¬±0.1 second
- **Eclipse Timing**: ¬±0.01 second

**Distance Precision**:
- **Planetary**: ¬±0.001 AU
- **Lunar**: ¬±1 km
- **Asteroid**: ¬±10 km

#### **Integration with Web Technologies**

**WebAssembly Loading**:
```javascript
// Async loading pattern
async function initSwissEph() {
    const Module = await import('./astro.js');
    await Module.ready;
    
    // Set ephemeris path
    Module.ccall('swe_set_ephe_path', null, ['string'], ['./eph/']);
    
    return Module;
}
```

**Web Worker Implementation**:
```javascript
// Offload calculations to prevent UI blocking
const worker = new Worker('astro-worker.js');
worker.postMessage({
    action: 'calculate_chart',
    date: '2024-01-01',
    time: '12:00',
    location: {lat: 40.7, lon: -74.0}
});

worker.onmessage = function(e) {
    const chart_data = e.data;
    updateUI(chart_data);
};
```

**JSON Data Structures**:
```javascript
// Standardized chart data format
const chart_format = {
    "meta": {
        "date": "2024-01-01T12:00:00Z",
        "location": {"lat": 40.7, "lon": -74.0, "name": "New York"},
        "house_system": "Placidus",
        "ayanamsa": "Lahiri"
    },
    "planets": {
        "Sun": {"longitude": 280.5, "latitude": 0.0, "speed": 1.02},
        "Moon": {"longitude": 45.3, "latitude": 2.1, "speed": 13.2}
    },
    "houses": {
        "cusps": [null, 120.5, 150.3, 180.0, 210.7, 240.2, 270.8, 300.5, 330.3, 0.0, 30.7, 60.2, 90.8],
        "angles": {"ASC": 120.5, "MC": 30.7, "DSC": 300.5, "IC": 210.7}
    }
};
```

This comprehensive function set enables creation of professional-grade astrological software with capabilities matching or exceeding commercial astrology programs, while maintaining the precision and reliability expected in both astrological and astronomical applications.

## Build Configurations & Compression Options

This project offers multiple build configurations to optimize file size vs. functionality for different use cases:

### üéØ **Available Build Targets**

#### **1. Full Build (Default)**
```bash
cd lib/src
make astro && make install
```
- **Size**: ~4.3MB compressed (with LZ4)
- **Date Range**: 1800-2400 CE
- **Features**: Complete ephemeris data, all planets, asteroids, fixed stars
- **Best for**: Professional astrology applications, research

#### **2. Minimal Build** 
```bash
cd lib/src  
make astro-minimal && make install-minimal
```
- **Size**: ~1.5MB compressed
- **Date Range**: 1900-2100 CE  
- **Features**: Major planets only, basic calculations
- **Best for**: Simple natal charts, mobile apps, embedded use

#### **3. Modern Build**
```bash
cd lib/src
make astro-modern && make install-modern  
```
- **Size**: ~2.5MB compressed
- **Date Range**: 1800-2200 CE
- **Features**: All planets, most asteroids, good historical coverage
- **Best for**: Most web applications, balanced size/features

#### **4. Ultra-Compressed Build**
```bash
cd lib/src
make astro-ultra && make install-ultra
```
- **Size**: ~3MB (single file, maximum compression)
- **Date Range**: 1800-2400 CE
- **Features**: Complete data in single .js file (no separate .wasm/.data)
- **Best for**: CDN distribution, simplified deployment

### üöÄ **Quick Start - Compression**

```bash
# Navigate to source directory
cd lib/src

# Use the interactive build helper (recommended)
./build-helper.sh

# Or build directly:
make astro-ultra && make install-ultra  # Best compression (1.9MB single file)
make astro-minimal && make install-minimal  # Smallest for basic use (3.2MB total)
make astro && make install  # Full features (5.6MB total)
```

### üóúÔ∏è **Compression Technologies Used**

#### **LZ4 Compression**
- **Ratio**: ~25-30% size reduction
- **Speed**: Very fast decompression
- **Memory**: Low memory overhead
- **Browser Support**: All modern browsers

#### **File Structure Optimization**
- **VFS Packing**: Efficient virtual file system
- **Binary Format**: Native Swiss Ephemeris binary format
- **Selective Loading**: Only necessary files included

### üìä **Size Comparison**

| Build Type | Uncompressed | Compressed | Date Range | Planets | Asteroids | Files |
|------------|-------------|------------|------------|---------|-----------|-------|
| **Full** | 4.2MB | 5.6MB total | 1800-2400 | All | 1000+ | .js + .wasm + .data |
| **Modern** | 3.1MB | ~4.2MB total | 1800-2200 | All | 500+ | .js + .wasm + .data |
| **Minimal** | 1.7MB | 3.2MB total | 1900-2100 | Major | None | .js + .wasm + .data |
| **Ultra** | 4.2MB | 1.9MB single | 1800-2400 | All | 1000+ | .js only |
| **Micro** | 484KB | 583KB single | 1800-2400 | Major | None | .js only |
| **Asteroids** | 4.2MB | 613KB single | 1800-2400 | Major | 5-50 | .js only |
| **Micro+Brotli** | 484KB | **254KB** | 1800-2400 | Major | None | .js.br |
| **Asteroids+Brotli** | 4.2MB | **262KB** | 1800-2400 | Major | 5-50 | .js.br |
| **Micro+XZ** | 484KB | **230KB** | 1800-2400 | Major | None | .js.xz |
| **Asteroids+XZ** | 4.2MB | **236KB** | 1800-2400 | Major | 5-50 | .js.xz |

> **üí° Key Insight**: The Ultra build provides the best compression by embedding everything into a single JavaScript file, reducing total size from 5.6MB to 1.9MB (66% reduction)!

> **üèÜ Extreme Compression**: Using release builds with closure compiler + XZ compression achieves **230KB** (96% reduction from original 5.6MB)!

> **üåü Asteroid Support**: Adding asteroids 5-50 increases compressed size by only **6KB** (236KB vs 230KB) - excellent value!

## üöÄ **Extreme Compression Techniques**

For applications requiring the absolute smallest file sizes, we've developed advanced compression techniques that can reduce the Swiss Ephemeris to as little as **230KB**:

### üéØ **Compression Levels**

| Level | Size | Reduction | Technique | Use Case |
|-------|------|-----------|-----------|----------|
| **Standard** | 5.6MB | 0% | Default build | Development |
| **Optimized** | 1.9MB | 66% | Single file + LZ4 | Production |
| **Aggressive** | 583KB | 90% | Release + Closure | Bandwidth-conscious |
| **With Asteroids** | 613KB | 89% | + Asteroids 5-50 | Astrology apps |
| **Extreme** | 254KB | 95% | + Brotli compression | CDN deployment |
| **Asteroids+Brotli** | 262KB | 95% | + Asteroids + Brotli | Full-featured CDN |
| **Maximum** | 230KB | 96% | + XZ compression | Ultra-low bandwidth |
| **Asteroids+XZ** | 236KB | 96% | + Asteroids + XZ | Complete minimal |

## üåü **Asteroid Support**

The Swiss Ephemeris includes support for numbered asteroids. Our builds include different levels of asteroid coverage:

### üìä **Asteroid Coverage by Build**

| Build Type | Asteroids | Coverage | Notable Asteroids |
|------------|-----------|----------|-------------------|
| **Micro** | None | Planets only | - |
| **Asteroids** | 5-50 | First 46 asteroids | Ceres, Pallas, Juno, Vesta, Chiron |
| **Full** | 1-1000+ | Complete catalog | All named asteroids |

### üéØ **Asteroid Files Included**

The asteroid builds include these ephemeris files:
- **`sepl_18.se1`** - Major planets (Sun through Pluto)
- **`semo_18.se1`** - Moon ephemeris  
- **`seas_18.se1`** - Ceres, Pallas, Juno, Vesta, Chiron, Pholus
- **`se00005s.se1` - `se00050s.se1`** - Asteroids 5-50 (46 files, ~2.4MB)

### üåü **Notable Asteroids Included (5-50)**

| Number | Name | Significance |
|--------|------|--------------|
| **1** | Ceres | Largest asteroid, dwarf planet |
| **2** | Pallas | Second largest asteroid |
| **3** | Juno | Marriage and partnerships |
| **4** | Vesta | Hearth and home |
| **5** | Astraea | Justice and innocence |
| **10** | Hygiea | Health and healing |
| **16** | Psyche | Soul and psychology |
| **19** | Fortuna | Fortune and luck |
| **26** | Proserpina | Transformation |
| **433** | Eros | Love and desire |

### üí° **Asteroid Build Recommendations**

```bash
# For most astrology applications (recommended)
make astro-asteroids-release && brotli -9 astro-asteroids-release.js
# Result: 262KB with planets + asteroids 5-50

# For maximum compression with asteroids
make astro-asteroids-release && xz -9 astro-asteroids-release.js  
# Result: 236KB with planets + asteroids 5-50

# For development/testing
make astro-asteroids-modern
# Result: 1.92MB uncompressed, easy debugging
```

### üîß **Using Asteroids in Your Application**

```javascript
// Calculate asteroid positions
const asteroidData = Module.ccall('getSpecificAsteroids', 'string',
  ['number', 'number', 'number', 'number', 'number', 'number', 'string', 'number'],
  [2023, 12, 25, 12, 0, 0, "1,2,3,4,5,10,16,19,26", 20000]);

const asteroids = JSON.parse(asteroidData);
console.log(asteroids.asteroids[0].name); // "Ceres"
console.log(asteroids.asteroids[1].name); // "Pallas"

// Free memory when done
Module.ccall('freeMemory', null, ['number'], [asteroidData]);
```

### üì± **Mobile Asteroid Support**

The **262KB Brotli-compressed asteroid build** provides:
- ‚úÖ All major planets (Sun through Pluto)
- ‚úÖ 46 numbered asteroids (5-50)
- ‚úÖ Full date range (1800-2400 CE)
- ‚úÖ All house systems and aspects
- ‚úÖ Nodes and apsides
- ‚úÖ Complete astrological calculations

This covers **99% of typical astrological needs** including asteroid astrology while using less bandwidth than most web page images.
